# VBA コード作成の共通要件

## コーディング規約
```
以下の規約に従ってVBAコードを作成してください：

1. 変数宣言：
   - Option Explicitを前提とした記述
   - すべての変数に明示的な型宣言
   - 意図的な場合を除きVariant型を使用しない
   - 配列の場合は要素数の上限を明示

2. 命名規則：
   - プロシージャ名：動詞で開始（例：Calculate～, Get～, Set～）
   - 変数名：キャメルケース（例：lastRow, maxValue）
   - 定数名：大文字のスネークケース（例：MAX_ROW_COUNT）
   - イミディエイトウィンドウ出力用の変数名にDebugプレフィックス

3. エラー処理：
   - On Error処理の必須実装
   - エラー発生時の適切なエラーハンドラへの移行
   - リソース解放の保証（Set obj = Nothing）

4. コードの構造：
   - プロシージャの責務を単一に保つ
   - 1プロシージャの長さを100行以内に抑える
   - ネストの深さを3レベル以内に抑える
   - マジックナンバーの定数化

5. パフォーマンス考慮：
   - Application.ScreenUpdating = Falseの適切な使用
   - 配列での一括処理の活用
   - With構文の活用
   - Select/Activateの使用を最小限に
```

## モジュール構成
```
以下の構成でコードを整理してください：

1. モジュール先頭：
   Option Explicit
   任意：Option Base 1
   任意：Option Private Module

2. 定数定義セクション：
   - シート名
   - 範囲指定
   - メッセージ文
   - 設定値

3. 型定義セクション：
   - Type構造体
   - Enum列挙型

4. 変数定義セクション：
   - モジュールレベルの変数
   - パブリック変数（必要な場合のみ）

5. メインプロシージャ：
   - 実行手順の明確化
   - 前提条件の検証
   - エラーハンドリング

6. サブプロシージャ：
   - 機能単位での分割
   - メインプロシージャとの依存関係を明示
```

## ドキュメンテーション
```
以下の要素をコメントとして含めてください：

1. モジュールヘッダー：
   - 目的
   - 作成日
   - 更新履歴
   - 依存モジュール

2. プロシージャヘッダー：
   - 機能概要
   - パラメータ説明
   - 戻り値の説明
   - エラー条件
   - 使用例

3. コードコメント：
   - 複雑なロジックの説明
   - 重要な判断条件
   - 既知の制限事項
   - TODO項目
```

## 品質保証要件
```
以下の品質要件を満たすようにしてください：

1. 入力値の検証：
   - Null/Empty/Missingの区別
   - 型チェック
   - 範囲チェック
   - 書式チェック

2. 実行時の安全性：
   - メモリリーク防止
   - 無限ループ防止
   - スタックオーバーフロー防止

3. エラー回復性：
   - 途中経過の保存
   - ロールバック処理
   - エラーログの出力

4. デバッグ支援：
   - トレースログの出力
   - 重要変数値の確認コード
   - 処理時間の計測
```

## テスト要件
```
以下のテスト項目を考慮してください：

1. 境界値テスト：
   - 最小値/最大値
   - 空データ
   - 大量データ

2. エラーテスト：
   - シート不在
   - 範囲外アクセス
   - 型変換エラー
   - 権限エラー

3. 再現性テスト：
   - 初期状態の定義
   - テストデータの準備手順
   - 期待値の定義
```

これらの要件は、コード作成の具体的な要件と組み合わせて使用することで、より堅牢で保守性の高いVBAコードを作成することができます。追加や修正が必要な点はありますでしょうか？